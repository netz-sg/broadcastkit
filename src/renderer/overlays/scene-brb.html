<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Be Right Back - Stream Scene</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Orbitron:wght@500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --accent: #f59e0b;
      --bg: #0a0a0f;
    }
    
    body {
      width: 100vw;
      height: 100vh;
      min-height: 100%;
      background: var(--bg);
      overflow: hidden;
      font-family: 'Inter', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    /* Animated Background */
    .bg-animated {
      position: absolute;
      inset: 0;
      overflow: hidden;
    }
    
    .bg-grid {
      position: absolute;
      inset: 0;
      background-image: 
        linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: gridMove 20s linear infinite;
    }
    
    @keyframes gridMove {
      0% { transform: translate(0, 0); }
      100% { transform: translate(50px, 50px); }
    }
    
    .bg-glow {
      position: absolute;
      width: clamp(400px, 45vw, 1000px);
      height: clamp(400px, 45vw, 1000px);
      border-radius: 50%;
      background: radial-gradient(circle, var(--accent) 0%, transparent 70%);
      opacity: 0.15;
      filter: blur(100px);
      animation: glowPulse 4s ease-in-out infinite;
    }
    
    .bg-glow-1 { top: -200px; left: -200px; }
    .bg-glow-2 { bottom: -200px; right: -200px; animation-delay: -2s; }
    
    @keyframes glowPulse {
      0%, 100% { opacity: 0.1; transform: scale(1); }
      50% { opacity: 0.2; transform: scale(1.1); }
    }

    /* Floating particles */
    .particles {
      position: absolute;
      inset: 0;
      overflow: hidden;
    }
    
    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--accent);
      border-radius: 50%;
      opacity: 0.3;
      animation: float 15s infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
      10% { opacity: 0.3; }
      90% { opacity: 0.3; }
      100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
    }

    /* Content Container */
    .content {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%) translateY(30px);
      z-index: 10;
      text-align: center;
      opacity: 0;
      transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
      width: 90%;
      max-width: 80vw;
      padding: 0 5vw;
    }
    
    .content.visible {
      opacity: 1;
      transform: translate(-50%, -50%) translateY(0);
    }
    
    .content.hidden {
      opacity: 0;
      transform: translate(-50%, -50%) translateY(-30px);
    }

    /* BRB Icon */
    .brb-icon {
      width: clamp(80px, 8vw, 150px);
      height: clamp(80px, 8vw, 150px);
      margin: 0 auto clamp(20px, 3vw, 50px);
      background: linear-gradient(135deg, var(--accent), #fbbf24);
      border-radius: clamp(15px, 2vw, 40px);
      display: flex;
      align-items: center;
      justify-content: center;
      animation: iconPulse 2s ease-in-out infinite;
      box-shadow: 0 20px 60px rgba(245, 158, 11, 0.3);
    }
    
    @keyframes iconPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .brb-icon svg {
      width: clamp(40px, 4vw, 80px);
      height: clamp(40px, 4vw, 80px);
      color: white;
    }

    /* Title */
    .title {
      font-size: clamp(36px, 5vw, 90px);
      font-weight: 800;
      color: white;
      margin-bottom: clamp(8px, 1vw, 20px);
      text-shadow: 0 4px 30px rgba(0,0,0,0.5);
      letter-spacing: -0.02em;
    }

    /* Subtitle */
    .subtitle {
      font-size: clamp(16px, 2vw, 36px);
      color: rgba(255,255,255,0.6);
      margin-bottom: clamp(30px, 4vw, 80px);
      font-weight: 500;
    }

    /* Countdown */
    .countdown {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: clamp(10px, 2vw, 30px);
      margin-bottom: clamp(30px, 4vw, 80px);
    }
    
    .countdown-box {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: clamp(10px, 1.5vw, 25px);
      padding: clamp(15px, 2vw, 40px) clamp(25px, 3.5vw, 70px);
      backdrop-filter: blur(10px);
    }
    
    .countdown-value {
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(40px, 5.5vw, 100px);
      font-weight: 700;
      color: var(--accent);
      line-height: 1;
      text-shadow: 0 0 40px var(--accent);
    }
    
    .countdown-label {
      font-size: clamp(10px, 1vw, 18px);
      color: rgba(255,255,255,0.4);
      text-transform: uppercase;
      letter-spacing: 0.2em;
      margin-top: clamp(5px, 0.7vw, 15px);
    }
    
    .countdown-separator {
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(30px, 4vw, 80px);
      color: var(--accent);
      opacity: 0.5;
      animation: blink 1s ease-in-out infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 0.1; }
    }

    /* Loading dots */
    .loading-dots {
      display: flex;
      justify-content: center;
      gap: clamp(8px, 1vw, 16px);
      margin-bottom: clamp(20px, 3vw, 50px);
    }
    
    .dot {
      width: clamp(8px, 1vw, 16px);
      height: clamp(8px, 1vw, 16px);
      background: var(--accent);
      border-radius: 50%;
      animation: dotPulse 1.5s ease-in-out infinite;
    }
    
    .dot:nth-child(2) { animation-delay: 0.2s; }
    .dot:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes dotPulse {
      0%, 100% { transform: scale(1); opacity: 0.3; }
      50% { transform: scale(1.5); opacity: 1; }
    }

    /* Hide state */
    .content.hidden {
      opacity: 0;
      transform: translate(-50%, -50%) translateY(-30px);
    }

    /* Progress bar */
    .progress-container {
      width: clamp(200px, 30vw, 500px);
      height: clamp(4px, 0.4vw, 8px);
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      margin: 0 auto clamp(30px, 4vw, 80px);
      overflow: hidden;
    }
    
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), #fbbf24);
      border-radius: 3px;
      transition: width 1s linear;
      box-shadow: 0 0 20px var(--accent);
    }
  </style>
</head>
<body>
  <!-- Animated Background -->
  <div class="bg-animated">
    <div class="bg-grid"></div>
    <div class="bg-glow bg-glow-1"></div>
    <div class="bg-glow bg-glow-2"></div>
  </div>
  
  <!-- Particles -->
  <div class="particles">
    <script>
      for(let i = 0; i < 20; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = Math.random() * 100 + '%';
        p.style.animationDelay = Math.random() * 15 + 's';
        p.style.animationDuration = (10 + Math.random() * 10) + 's';
        document.querySelector('.particles').appendChild(p);
      }
    </script>
  </div>

  <!-- Content -->
  <div id="content" class="content visible">
    <div class="brb-icon">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    </div>
    
    <h1 id="title" class="title">Gleich zurück</h1>
    <p id="subtitle" class="subtitle">Kurze Pause...</p>
    
    <div class="loading-dots">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
    
    <div id="countdown" class="countdown">
      <div class="countdown-box">
        <div id="minutes" class="countdown-value">05</div>
        <div class="countdown-label">Minuten</div>
      </div>
      <div class="countdown-separator">:</div>
      <div class="countdown-box">
        <div id="seconds" class="countdown-value">00</div>
        <div class="countdown-label">Sekunden</div>
      </div>
    </div>
    
    <div id="progress-container" class="progress-container">
      <div id="progress-bar" class="progress-bar" style="width: 100%"></div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const content = document.getElementById('content');
    const titleEl = document.getElementById('title');
    const subtitleEl = document.getElementById('subtitle');
    const countdownEl = document.getElementById('countdown');
    const minutesEl = document.getElementById('minutes');
    const secondsEl = document.getElementById('seconds');
    const progressBar = document.getElementById('progress-bar');
    const progressContainer = document.getElementById('progress-container');
    
    let totalSeconds = 300;
    let initialSeconds = 300;
    
    function updateCountdown(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      minutesEl.textContent = mins.toString().padStart(2, '0');
      secondsEl.textContent = secs.toString().padStart(2, '0');
      
      const progress = (seconds / initialSeconds) * 100;
      progressBar.style.width = progress + '%';
    }
    
    function setAccentColor(color) {
      document.documentElement.style.setProperty('--accent', color);
    }
    
    socket.on('overlay-event', (data) => {
      if (data.module === 'STREAM_SCENE' && data.payload.sceneId === 'brb') {
        const payload = data.payload;
        
        if (payload.action === 'SHOW') {
          const config = payload.config;
          titleEl.textContent = config.title || 'Gleich zurück';
          subtitleEl.textContent = config.subtitle || '';
          setAccentColor(config.accentColor || '#f59e0b');
          
          if (config.showCountdown && config.remainingSeconds > 0) {
            totalSeconds = config.remainingSeconds;
            initialSeconds = config.remainingSeconds;
            updateCountdown(totalSeconds);
            countdownEl.style.display = 'flex';
            progressContainer.style.display = 'block';
          } else {
            countdownEl.style.display = 'none';
            progressContainer.style.display = 'none';
          }
          
          content.classList.remove('hidden');
          content.classList.add('visible');
        }
        
        if (payload.action === 'UPDATE_COUNTDOWN') {
          updateCountdown(payload.remainingSeconds);
        }
        
        if (payload.action === 'HIDE') {
          content.classList.remove('visible');
          content.classList.add('hidden');
        }
      }
    });
    
    fetch('/api/config')
      .then(res => res.json())
      .then(config => {
        const scene = config.overlays?.streamScenes?.scenes?.brb;
        if (scene) {
          titleEl.textContent = scene.title;
          subtitleEl.textContent = scene.subtitle;
          setAccentColor(scene.accentColor);
          if (scene.showCountdown) {
            totalSeconds = scene.countdownMinutes * 60;
            initialSeconds = totalSeconds;
            updateCountdown(totalSeconds);
          } else {
            countdownEl.style.display = 'none';
            progressContainer.style.display = 'none';
          }
        }
        // Show content by default
        content.classList.add('visible');
      });
  </script>
</body>
</html>
